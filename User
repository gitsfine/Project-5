import java.util.ArrayList;
import java.util.Scanner;

public class User {

    private String username;
    private String password;
    private String email;
    private boolean seller;

    public User () {

    }
    public User (String username, String password, String email, boolean seller) {
        this.username = username;
        this.password = password;
        this.email = email;
        this.seller = seller;
    }

    public String getUsername() {
        return username;
    }
    public String getPassword() {
        return password;
    }
    public String getEmail() {
        return email;
    }

    public boolean isSeller() {
        return seller;
    }
    public void setUsername(String username) {
        this.username = username;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public void setSeller(boolean seller) {
        this.seller = seller;
    }

    public String toString() {
        if (seller) {
            return String.format("Seller | Username: %s | Password: %s\nEmail: %s\n", username, password, email);
        } else {
            return String.format("Customer | Username: %s | Password: %s\nEmail: %s\n", username, password, email);
        }
    }

    public void statistics() { // statistics method
        // CODE
    }

    public void exportFile() { // exportFile method
        // CODE
    }

    //begin editAccount method
    public User editAccount(User user) {
        Scanner scanner = new Scanner(System.in);

        String username = "";
        String password = "";

        boolean noPick;
        do {
            noPick = false;
            System.out.printf("What would you like to edit?\n1. Username\n2. Password\n");
            int choice = scanner.nextInt();
            scanner.nextLine();

            if (choice == 1) {
                // edit username
                boolean invalidUsername = true;
                while (invalidUsername) {
                    boolean hasLetter = false;
                    boolean hasNumber = false;
                    System.out.println("Please create a username. Username must contain at least one letter and one number.");
                    username = scanner.nextLine();
                    for (int i = 0; i < username.length(); i++) { // traverse length of given username
                        if (Character.isDigit(username.charAt(i))) { // check for at least one number
                            hasNumber = true;
                        }
                        if (Character.isLetter(username.charAt(i))) { // check for at least one letter
                            hasLetter = true;
                        }
                    }

                    if (hasNumber && hasLetter) {
                        boolean alreadyTaken = false;
                        for (int i = 0; i < Marketplace.userArrayList.size(); i++) {
                            if (username.equals(Marketplace.userArrayList.get(i).getUsername())) {
                                alreadyTaken = true;
                            }
                        }

                        if (alreadyTaken) {
                            System.out.println("I'm sorry, that username is already taken :(");
                        } else {
                            System.out.println("Thank you for creating a valid username.\n"); // if both true, username is
                            invalidUsername = false;
                        }
                    } else if (hasNumber) {
                        System.out.println("Username is missing a letter. Please try again."); // re-prompt
                    } else if (hasLetter) {
                        System.out.println("Username is missing a number. Please try again."); // re-prompt
                    } else {
                        System.out.println("Username does not contain a letter and number. Please try again."); // re-prompt
                    }
                }
                System.out.printf("Great! Your username was changed from %s to %s!\n", user.getUsername(), username);
                user.setUsername(username);

                //editing data.txt
                ArrayList<String> data = Marketplace.readData();
                String email = user.getEmail();
                int emailIndex = 0;

                for (int i = 0; i < data.size(); i++) {
                    if (data.get(i).equals(email)) {
                        emailIndex = i;
                    }
                }
                data.set((emailIndex - 2), username); //change username
                String stores = data.get(emailIndex + 2);
                stores = stores.substring(stores.indexOf("'"));
                data.set((emailIndex + 2), (username + stores)); //change username

                Marketplace.writeData(data);

                //edit password
            } else if (choice == 2) {
                boolean invalidPassword = true;
                while (invalidPassword) {
                    System.out.println("Please create a password. Note: Must contain at least six digits. Must contain at" +
                            " least one letter and one number.");
                    password = scanner.nextLine();
                    if (password.length() < 6) {
                        System.out.println("Password is too short. Please try again.");
                    } else { // password is longer than 6 characters
                        boolean hasLetter = false;
                        boolean hasNumber = false;
                        for (int i = 0; i < password.length(); i++) { // traverse length of given username
                            if (Character.isDigit(password.charAt(i))) { // check for at least one number
                                hasNumber = true;
                            }
                            if (Character.isLetter(password.charAt(i))) { // check for at least one letter
                                hasLetter = true;
                            }
                        }

                        if (hasNumber && hasLetter) {
                            System.out.println("Thank you for creating a valid password.\n"); // if both true, username is
                            invalidPassword = false;
                        } else if (hasNumber) {
                            System.out.println("Password is missing a letter. Please try again."); // re-prompt
                        } else if (hasLetter) {
                            System.out.println("Password is missing a number. Please try again."); // re-prompt
                        } else {
                            System.out.println("Password does not contain a letter and number. Please try again."); // re-prompt
                        }
                    }
                }
                System.out.printf("Great! Your password was changed.\n");
                user.setPassword(password);

                //editing data.txt
                ArrayList<String> data = Marketplace.readData();
                String email = user.getEmail();
                int emailIndex = 0;

                for (int i = 0; i < data.size(); i++) {
                    if (data.get(i).equals(email)) {
                        emailIndex = i;
                    }
                }
                data.set((emailIndex - 1), password); //change password

                Marketplace.writeData(data);
            } else {
                noPick = true;
            }
        } while (noPick);

        return user;
    } // end editAccount method
}
